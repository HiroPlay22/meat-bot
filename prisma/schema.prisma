// FILE: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // url = env("DATABASE_URL")  // ‚Üê falls bei dir schon vorhanden, wieder einsetzen
}

model CommandUsage {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())

  guildId     String?  @db.VarChar(32)
  channelId   String?  @db.VarChar(32)
  userId      String?  @db.VarChar(32)

  commandName String
}

enum TrackingStatus {
  NONE
  ALLOWED
  DENIED
}

model UserTrackingConsent {
  id        String         @id @default(cuid())
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  guildId   String         @db.VarChar(32)
  userId    String         @db.VarChar(32)
  status    TrackingStatus
  version   String?        @db.VarChar(32)

  @@unique([guildId, userId])
}

model CommandStatsGuildDaily {
  id          String   @id @default(cuid())
  date        DateTime
  guildId     String   @db.VarChar(32)
  commandName String
  totalCount  Int      @default(0)

  @@unique([date, guildId, commandName], name: "date_guildId_commandName")
}

// üîπ Polls f√ºr Montags-Runde

enum PollType {
  MONTAG
}

enum PollStatus {
  ACTIVE
  CLOSED
}

model Poll {
  id               String     @id @default(cuid())
  guildId          String     @db.VarChar(32)

  type             PollType
  status           PollStatus @default(ACTIVE)

  question         String
  discordChannelId String     @db.VarChar(32)
  discordMessageId String     @db.VarChar(32)

  startedAt        DateTime   @default(now())
  endsAt           DateTime?
  createdByUserId  String     @db.VarChar(32)
  closedAt         DateTime?

  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@index([guildId, type, status])
}
