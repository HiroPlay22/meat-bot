import { EmbedBuilder, User } from 'discord.js';
import { imageAssets } from './imageAssets.js';
import { emoji, safe } from '@/utils/meatEmojis.js';

export function buildRollEmbed({
  phase,
  user,
  type,
  count,
  modifier,
  gmEnabled
}: {
  phase: 'phase1' | 'phase2' | 'phase3';
  user: User;
  type?: 'd6' | 'd4' | 'd8' | 'd10' | 'd12' | 'd20';
  count?: number;
  modifier?: number;
  gmEnabled?: boolean;
}) {
  const embed = new EmbedBuilder()
    .setColor(0x5865f2)
    .setAuthor({ name: `${user.username} w√ºrfelt...`, iconURL: user.displayAvatarURL() });

  switch (phase) {
    case 'phase1': {
      embed
        .setTitle('üé≤ Zufallsbefehl getriggert')
        .setDescription('Bereit f√ºr das Unbekannte?')
        .setImage(imageAssets.rollStart);
      break;
    }

    case 'phase2': {
      if (!type) throw new Error('Missing dice type in phase2');

      const titleEmoji = type === 'd6' ? emoji.meat_dice : emoji.meat_dnd;
      embed
        .setTitle(`${safe(titleEmoji)} ${type === 'd6' ? 'W√ºrfelmodus aktiviert' : 'DnD-Modus aktiviert'}`)
        .setDescription('Wie viele W√ºrfel m√∂chtest du rollen?')
        .setImage(type === 'd6' ? imageAssets.rollDiceClassic : imageAssets.rollDiceDnd);
      break;
    }

    case 'phase3': {
      if (!type || !count) throw new Error('Missing type or count in phase3');

      const titleEmoji = type === 'd6' ? emoji.meat_dice : emoji.meat_dnd;
      const modText = modifier !== undefined ? ` mit einem Modifier von ${modifier > 0 ? `+${modifier}` : modifier}` : '';
      const footerText = `${safe(titleEmoji)} ${count}√ó ${type}${modifier !== undefined ? ` ${modifier > 0 ? '+' : ''}${modifier}` : ''}`;

      embed
        .setTitle(`${safe(titleEmoji)} ${count}√ó ${type}`)
        .setDescription(`Du hast ${count}√ó ${type} gew√§hlt${modText}. Jetzt leg los!`)
        .setImage(type === 'd6' ? imageAssets.rollDiceClassic : imageAssets.rollDiceDnd)
        .setFooter({ text: footerText });

      if (gmEnabled) {
        embed.addFields({
          name: `${safe(emoji.meat_gm)} GM-Channel-Modus aktiviert`,
          value: 'Dein Ergebnis wird im GameMaster-Channel ver√∂ffentlicht.'
        });
      }
      break;
    }
  }

  return embed;
}
