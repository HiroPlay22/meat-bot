import { Client } from 'discord.js';
import fs from 'fs';
import path from 'path';

/**
 * Postet einen Twitch-Clip-Link in den konfigurierten Discord-Kanal.
 * L√§dt die channelId aus config/serverSettings.json
 */
export async function postClipToDiscord(discordClient: Client, clipUrl: string) {
  const settingsPath = path.resolve(process.cwd(), 'config/serverSettings.json');
  const config = JSON.parse(fs.readFileSync(settingsPath, 'utf-8'));

  // Optional: explizite Guild-ID ausw√§hlen (erste nehmen)
  const guildId = Object.keys(config.guilds)[0];
  const clipChannelId = config.guilds[guildId]?.clipChannelId;

  if (!clipChannelId) {
    console.error('‚ùå Kein clipChannelId f√ºr Guild gefunden.');
    return;
  }

  const channel = await discordClient.channels.fetch(clipChannelId);
  if (!channel?.isTextBased()) {
    console.error(`‚ùå Channel ${clipChannelId} ist ung√ºltig oder nicht textbasiert.`);
    return;
  }

  await channel.send(`üé¨ Neuer Clip: ${clipUrl}`);
  console.log(`‚úÖ Clip gepostet: ${clipUrl}`);
}
